#!/usr/bin/env bash
set -euo pipefail

# Pre-push hook: run coverage check and tests locally before allowing push
REPO_ROOT="$(git rev-parse --show-toplevel)"
HOOK_SCRIPT="$REPO_ROOT/scripts/check_coverage.sh"

if [ ! -x "$HOOK_SCRIPT" ]; then
  echo "Making $HOOK_SCRIPT executable"
  chmod +x "$HOOK_SCRIPT" || true
fi

echo "Running pre-push tests and coverage check via make"
make -C "$REPO_ROOT" check-coverage

echo "Pre-push checks passed"
